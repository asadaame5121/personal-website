---
layout: layout.njk
---

<div class="map-container">
  <div id="map-view"></div>
</div>

<style>
  .map-container {
    width: 100%;
    height: 100vh;
    overflow: hidden;
    position: relative;
  }
  
  #map-view {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: auto;
  }
  
  .tiled-tile {
    transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out;
  }
  
  .tiled-tile:hover {
    transform: scale(1.05);
    filter: brightness(1.2);
    z-index: 10;
  }
  
  .tile-tooltip {
    position: absolute;
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 14px;
    pointer-events: none;
    z-index: 1000;
    max-width: 200px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }
</style>

<script src="/assets/js/tiled-map-loader.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // マップの読み込み
    const mapLoader = new TiledMapLoader({
      container: '#map-view',
      mapUrl: '/assets/maps/continent-map.json',
      tilesetUrl: '/assets/images/Tiles/tilesheet_complete.png',
      onLoad: function(mapData) {
        console.log('マップの読み込みが完了しました', mapData);
      },
      onClick: function(tile) {
        console.log('タイルがクリックされました', tile);
        
        // カテゴリータイルの場合、該当ページへ遷移
        if (tile.properties.category) {
          window.location.href = `/${tile.properties.category.toLowerCase()}/`;
        }
        
        // 記事タイルの場合、該当記事へ遷移
        if (tile.properties.articleUrl) {
          window.location.href = tile.properties.articleUrl;
        }
      },
      onHover: function(tile) {
        // ホバー時の処理
        if (tile.type === 'enter') {
          showTileTooltip(tile);
        } else if (tile.type === 'leave') {
          hideTileTooltip();
        }
      }
    });
    
    // ツールチップを表示
    function showTileTooltip(tile) {
      // 既存のツールチップを削除
      hideTileTooltip();
      
      // ツールチップに表示する情報を取得
      let tooltipContent = '';
      
      if (tile.properties.category) {
        tooltipContent = `カテゴリー: ${tile.properties.category}`;
      } else if (tile.properties.title) {
        tooltipContent = tile.properties.title;
      } else if (tile.properties.type) {
        tooltipContent = `タイプ: ${tile.properties.type}`;
      }
      
      // 情報がない場合は表示しない
      if (!tooltipContent) return;
      
      // ツールチップ要素を作成
      const tooltip = document.createElement('div');
      tooltip.className = 'tile-tooltip';
      tooltip.textContent = tooltipContent;
      document.body.appendChild(tooltip);
      
      // マウスの位置に合わせてツールチップを配置
      document.addEventListener('mousemove', updateTooltipPosition);
      
      // ツールチップの位置を更新
      function updateTooltipPosition(e) {
        tooltip.style.left = `${e.pageX + 10}px`;
        tooltip.style.top = `${e.pageY + 10}px`;
      }
    }
    
    // ツールチップを非表示
    function hideTileTooltip() {
      const tooltip = document.querySelector('.tile-tooltip');
      if (tooltip) {
        document.removeEventListener('mousemove', updateTooltipPosition);
        tooltip.remove();
      }
    }
  });
</script>
